# Chapter 03. 관계형 데이터베이스 매핑
- - -

## 아키텍처 패턴
* 행 데이터 게이트웨이는 쿼리에서 반환한 행 하나당 인스턴스 하나를 가진다.
* SQL 접근을 도메인 논리와는 별도로 분리하고 개별 클래스에 배치하는 것이 좋다.
* 클래스를 구성하는 방법으로는 데이터베이스 테이블당 클래스 하나를 가지도록 데이터베이스 테이블의 테이블 구조를 바탕으로 클래스를 구성하는 것이 좋다.

### 게이트웨이
* 행 데이터 게이트웨이
  * 쿼리가 반환하는 각 행마다 인스턴스 하나를 만드는 방법
  * 데이터에 대한 객체지향적 사고방식과 잘 어울린다.
* 레코드 집합
  * 데이터베이스의 테이블식 특성을 흉내 낸 테이블과 행의 범용 자료구조다.
  * 데이터베이스의 각 테이블마다 클래스가 하나만 있으면 된다.
  * 테이블 데이터 게이트웨이는 데이터베이스를 쿼리하고 레코드 집합을 반환하는 메서드를 제공한다.
* 활성 레코드
  * 각 도메인 객체가 직접 데이터베이스 로드와 저장을 수행한다.
* 도메인 논리를 작은 클래스로 팩터링하기 시작하면 도메인 클래스와 테이블의 일대일 매칭이 깨지기 시작하므로, 항상 데이터베이스와 상호작용하지 않고도 도메인 논리를 테스트할 수 있는 방법이 필요하다.
* 데이터 매퍼는 데이터베이스와 도메인 모델이 서로 독립적으로 작동할 수 있게 중간에서 로딩과 저장을 대신 처리한다.
  * 두 계층의 완전한 격리라는 장점을 제공한다.

### 동작 문제
* 동작 문제는 객체가 데이터베이스에 저장 및 로드되는 방법이다.
* 객체를 읽고 수정하는 동안에는 사용하는 데이터베이스의 상태를 일관되게 유지해야 한다.
* 작업 단위는 데이터베이스를 일관되게 유지하는 데 필요한 패턴이다.
* 작업 단위는 데이터베이스 매핑의 컨트롤러로 작동하는 객체라고 생각하면 된다.
  * 작업 단위가 없을 때는 일반적으로 도메인 계층이 컨트롤러 역할을 해서 데이터베이스를 읽고 쓸 시점을 결정한다.
* 작업 단위는 데이터베이스 매핑 컨트롤러의 동작을 별도의 객체로 팩터링해서 만든 것이다.
