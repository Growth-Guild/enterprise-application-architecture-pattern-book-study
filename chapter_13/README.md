# Chapter 13. 객체-관계형 메타데이터 매핑 패턴
- - -

* 메타데이터 매핑은 매핑을 간단한 표 형식으로 정의하고 범용 코드를 통해 이를 처리함으로써 데이터 읽기, 삽입, 업데이트를 수행하는 방식이다.

## 작동 원리
* 메타데이터 매핑을 사용할 때는 코드 생성과 리플렉션 프로그래밍 방식이 있다.
* 코드 생성 방식에서는 메타데이터를 입력으로 받고 매핑을 수행하는 클래스의 소스코드를 출력하는 프로그램을 작성한다.
  * 일반적으로 컴파일 전에 빌드 프로세스 중 완전하게 생성된다.
  * 결과 매퍼 클래스는 서버 코드와 함께 배포되며, 현재 사용 중인 빌드 스크립트를 빌드 프로세스에 완전하게 통합하는 것이 중요하다.
  * 매핑을 조금이라도 변경하면 적어도 소프트웨어의 일부를 다시 컴파일하고 배포해야 하므로 유연성이 낮다.
* 리플렉션 프로그램 방식에서는 메서드와 필드를 데이터로 취급해 메타데이터 파일에서 필드와 메서드 이름을 읽고 이 정보를 기준으로 매핑한다.
  * 디버그하기가 어렵다는 단점이 있다.
  * 매핑 데이터 파일만 변경하면 기존 클래스가 새로운 메타데이터를 사용한다.
* 대부분의 경우 메타데이터는 별도의 파일 형식으로 저장한다.
  * XML은 계층 구조를 제공하며 직접 파서나 다른 툴을 만들지 않고도 이용할 수 있기 때문에 가장 인기 있는 방법이다.
  * 로딩 단계에서는 XML로 기록된 메타데이터를 읽고 이를 코드 생성 출력이나 리플렉션 매핑에 활용할 프로그래밍 언어 구조로 변환한다.
* 코드 생성 방식에서는 읽고 구문 분석하는 작업이 실행 중이 아닌 빌드 중에 수행된다.
* 리플렉션 프로그래밍 방식에서는 읽고 구문 분석하는 작업이 주로 실행 중 수행되지만 시스템 시작 시 한 번만 수행되며 이후에는 메모리에 저장된 표현을 사용한다.

## 사용 시점
* 메타데이터 매핑을 사용하면 데이터베이스 매핑 작업을 크게 간소화할 수 있다.
* 거의 모든 상황을 메타데이터 매핑으로 처리할 수 있지만 메타데이터를 아주 복잡하게 만드는 에외 상황이 있다.
* 계층 상위 형식을 만들고 공통적인 동작을 모두 처리하게 하면 작성해야 하는 코드의 양을 크게 줄일 수 있다.
* 메타데이터 매핑을 사용하면 리팩터링이 어려울 수 잇으며, 특히 자동화된 툴을 사용하는 경우 문제가 더 복잡하다.
  * 반면 메타데이터 매핑을 사용하면 메타데이터가 데이터베이스 스키마의 인터페이스를 나타내므로 데이터베이스 리팩터링이 더 쉬워질 수 있다. 즉, 데이터베이스에 대한 변경 사항을 메타 데이터 매핑을 편집해 해결할 수 있다.
